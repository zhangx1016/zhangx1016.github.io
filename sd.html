<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>è¯•å·ä¸‰åº¦åˆ†æç³»ç»Ÿ</title>
<style>
body{
    margin:0;
    font-family:"Microsoft YaHei",Arial;
    background:linear-gradient(120deg,#4facfe,#00f2fe);
}
.container{
    max-width:1200px;
    margin:60px auto;
    background:#e9f9ff;
    border-radius:18px;
    padding:30px;
    box-shadow:0 20px 40px rgba(0,0,0,.15);
}
.header{
    text-align:center;
    font-size:26px;
    color:#333;
    margin-bottom:30px;
}
.main{display:flex;gap:30px;}
.left,.right{
    background:#fff;
    border-radius:14px;
    padding:20px;
    flex:1;
}
textarea,input{
    width:100%;
    padding:10px;
    margin-top:10px;
    font-size:14px;
}
button{
    margin-top:15px;
    padding:10px 26px;
    font-size:16px;
    background:#409eff;
    color:#fff;
    border:none;
    border-radius:6px;
    cursor:pointer;
}
button:hover{background:#337ecc;}
.copy-btn{
    margin-left:12px;
    padding:4px 10px;
    font-size:13px;
    background:#67c23a;
    color:#fff;
    border:none;
    border-radius:4px;
    cursor:pointer;
}
.highlight{color:#e74c3c;font-weight:bold;}
.desc-box{
    margin-top:15px;
    padding:15px;
    background:#f7fbff;
    border-radius:10px;
    line-height:1.9;
}
table{
    width:100%;
    border-collapse:collapse;
    margin-top:15px;
}
th,td{
    border:1px solid #ccc;
    padding:8px;
    text-align:center;
}
th{background:#f0f8ff;}
</style>
</head>

<body>
<div class="container">
<div class="header">zhangx1016.github.io Â· è¯•å·ä¸‰åº¦åˆ†æ</div>

<div class="main">
<!-- å·¦ä¾§è¾“å…¥ -->
<div class="left">
<h3>ğŸ“¥ æˆç»©è¾“å…¥</h3>
<textarea id="scores" rows="10"
placeholder="æŒ‰æ•™åŠ¡ç³»ç»Ÿæˆç»©é¡ºåºç²˜è´´æˆç»©
ï¼ˆæ”¯æŒé€—å· / æ¢è¡Œï¼‰"></textarea>

<label>è¯•å·æ€»åˆ† Wï¼š</label>
<input type="number" id="totalScore" value="100">

<button onclick="calculate()">å¼€å§‹è®¡ç®—</button>
</div>

<!-- å³ä¾§è¾“å‡º -->
<div class="right">
<h3>ğŸ“Š ä¸‰åº¦è®¡ç®—ç»“æœ</h3>
<div id="result"></div>

<h3>ğŸ“‹ æˆç»©åˆ†å¸ƒç»Ÿè®¡è¡¨</h3>
<div id="tableBox"></div>

<h3>
ğŸ“ è‡ªåŠ¨åˆ†ææè¿°
<button class="copy-btn" onclick="copyDesc()">ä¸€é”®å¤åˆ¶</button>
</h3>
<div id="desc" class="desc-box"></div>
</div>
</div>
</div>

<script>
function calculate(){

/* ===== æˆç»©è§£æ ===== */
let scores=document.getElementById("scores").value
.replace(/ï¼Œ/g,",")
.split(/[\s,]+/)
.map(s=>parseFloat(s))
.filter(s=>!isNaN(s));
if(scores.length<4){alert("æˆç»©æ•°é‡ä¸è¶³");return;}

let W=+document.getElementById("totalScore").value||100;
let n=scores.length;
const avg=a=>a.reduce((x,y)=>x+y,0)/a.length;

/* ===== éš¾åº¦ & åŒºåˆ†åº¦ï¼ˆä¿æŒåŸç®—æ³•ï¼‰ ===== */
let sorted=[...scores].sort((a,b)=>b-a);
let m=Math.round(n*0.27);
let VH=avg(sorted.slice(0,m));
let VL=avg(sorted.slice(n-m));
let P=(VH+VL)/(2*W);
let D=(VH-VL)/W;

/* ===== ä¿¡åº¦ï¼ˆä¿æŒåŸç®—æ³•ï¼‰ ===== */
let mid=Math.floor(n/2);
let g1=scores.slice(0,mid);
let g2=scores.slice(mid);
let variance=a=>{
    let mean=avg(a);
    return a.reduce((s,x)=>s+(x-mean)**2,0)/a.length;
};
let R=variance(g1)/variance(g2);

/* ===== æˆç»©åˆ†æ®µ ===== */
let ranges=[
 {name:"ä¼˜ç§€(â‰¥90)",count:scores.filter(s=>s>=90).length,ratio:0.15},
 {name:"è‰¯å¥½(80â€“89)",count:scores.filter(s=>s>=80&&s<90).length,ratio:0.30},
 {name:"ä¸­ç­‰(70â€“79)",count:scores.filter(s=>s>=70&&s<80).length,ratio:0.40},
 {name:"åŠæ ¼(60â€“69)",count:scores.filter(s=>s>=60&&s<70).length,ratio:0.15},
 {name:"ä¸åŠæ ¼(<60)",count:scores.filter(s=>s<60).length,ratio:0.00}
];
ranges.forEach(r=>{
    r.rate=r.count/n*100;
    r.theory=(n*r.ratio).toFixed(1);
});

/* ===== æˆç»©åˆ†å¸ƒè¡¨ ===== */
document.getElementById("tableBox").innerHTML=`
<table>
<tr>
<th>åˆ†æ•°æ®µ</th>
<th>å®é™…äººæ•°</th>
<th>ç†è®ºäººæ•°</th>
<th>å æ¯”</th>
</tr>
${ranges.map(r=>`
<tr>
<td>${r.name}</td>
<td>${r.count}</td>
<td>${r.theory}</td>
<td>${r.rate.toFixed(2)}%</td>
</tr>`).join("")}
</table>`;

/* ===== æè¿°è¯è§„åˆ™ ===== */
let Pd=P>=0.8?"å¤ªæ˜“":P>=0.6?"è¾ƒæ˜“":P>=0.4?"é€‚ä¸­":P>=0.2?"è¾ƒéš¾":"å¤ªéš¾";
let Dd=D>=0.4?"åŒºåˆ†åº¦å¾ˆå¥½":D>=0.3?"åŒºåˆ†åº¦è¾ƒå¥½":D>=0.2?"åŒºåˆ†åº¦ä¸€èˆ¬":"åŒºåˆ†åº¦è¾ƒå·®";
let Rd=R<0.6?"è¯•é¢˜å­˜åœ¨ä¸¥é‡é—®é¢˜ï¼Œä¸å®œé‡‡ç”¨":R<0.8?"è¯•é¢˜è´¨é‡æœ‰æå‡ç©ºé—´":"è¯•å·å¯ä¿¡åº¦é«˜";

/* ===== ç™¾åˆ†æ¯”æè¿° ===== */
let rateText=ranges.map(r=>
    `${r.name.replace(/\\(.+?\\)/,"")}å ${r.rate.toFixed(2)}%`
).join("ï¼Œ");

/* ===== é›†ä¸­åŒºé—´ï¼ˆ1â€“2 ä¸ªï¼‰ ===== */
let sortedRanges=[...ranges].sort((a,b)=>b.count-a.count);
let main=[sortedRanges[0]];
if(sortedRanges[1].count>=sortedRanges[0].count*0.6){
    main.push(sortedRanges[1]);
}
let mainText=main.map(r=>r.name.replace(/\\(.+?\\)/,"")).join("å’Œ");

/* ===== è¾“å‡º ===== */
document.getElementById("result").innerHTML=`
éš¾åº¦ Pï¼š<span class="highlight">${P.toFixed(2)}</span><br>
åŒºåˆ†åº¦ Dï¼š<span class="highlight">${D.toFixed(2)}</span><br>
ä¿¡åº¦ Rï¼š<span class="highlight">${R.toFixed(2)}</span>
`;

document.getElementById("desc").innerHTML=`
è¯•å·éš¾åº¦ä¸º ${P.toFixed(2)}ï¼Œè¡¨æ˜è¯•å·éš¾åº¦ä¸º${Pd}ï¼›
è¯•å·åŒºåˆ†åº¦ä¸º ${D.toFixed(2)}ï¼Œè¡¨æ˜è¯•å·ä¸­é¢˜ç›®${Dd}ï¼›
è¯•å·ä¿¡åº¦ä¸º ${R.toFixed(2)}ï¼Œ${Rd}ã€‚
ä»æˆç»©åˆ†å¸ƒæƒ…å†µçœ‹ï¼Œ${rateText}ï¼Œ
æˆç»©ä¸»è¦é›†ä¸­åœ¨${mainText}åŒºé—´ã€‚
`;
}

/* ===== ä¸€é”®å¤åˆ¶çº¯æ–‡æœ¬ ===== */
function copyDesc(){
    let text=document.getElementById("desc").innerText;
    navigator.clipboard.writeText(text).then(()=>{
        alert("åˆ†ææè¿°å·²å¤åˆ¶ï¼Œå¯ç›´æ¥ç²˜è´´ä½¿ç”¨");
    });
}
</script>
</body>
</html>

