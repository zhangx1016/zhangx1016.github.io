<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>è¯•å·ä¸‰åº¦åˆ†æç³»ç»Ÿ</title>
<style>
body{
    margin:0;
    font-family:"Microsoft YaHei",Arial;
    background:linear-gradient(120deg,#4facfe,#00f2fe);
}
.container{
    max-width:1200px;
    margin:60px auto;
    background:#e9f9ff;
    border-radius:18px;
    padding:30px;
    box-shadow:0 20px 40px rgba(0,0,0,.15);
}
.header{
    text-align:center;
    font-size:26px;
    color:#333;
    margin-bottom:30px;
}
.main{display:flex;gap:30px;}
.left,.right{
    background:#fff;
    border-radius:14px;
    padding:20px;
    flex:1;
}
textarea,input{
    width:100%;
    padding:10px;
    margin-top:10px;
    font-size:14px;
}
button{
    margin-top:15px;
    padding:10px 26px;
    font-size:16px;
    background:#409eff;
    color:#fff;
    border:none;
    border-radius:6px;
    cursor:pointer;
}
button:hover{background:#337ecc;}
.highlight{color:#e74c3c;font-weight:bold;}
.desc-box{
    margin-top:15px;
    padding:15px;
    background:#f7fbff;
    border-radius:10px;
    line-height:1.9;
}
</style>
</head>

<body>
<div class="container">
    <div class="header">zhangx1016.github.io Â· è¯•å·ä¸‰åº¦åˆ†æ</div>

    <div class="main">
        <!-- å·¦ä¾§è¾“å…¥ -->
        <div class="left">
            <h3>ğŸ“¥ æˆç»©è¾“å…¥</h3>
            <textarea id="scores" rows="10"
            placeholder="æŒ‰æ•™åŠ¡ç³»ç»Ÿæˆç»©é¡ºåºç²˜è´´æˆç»©
ï¼ˆæ”¯æŒé€—å· / æ¢è¡Œï¼‰"></textarea>

            <label>è¯•å·æ€»åˆ† Wï¼š</label>
            <input type="number" id="totalScore" value="100">

            <button onclick="calculate()">å¼€å§‹è®¡ç®—</button>
        </div>

        <!-- å³ä¾§è¾“å‡º -->
        <div class="right">
            <h3>ğŸ“Š è®¡ç®—ç»“æœ</h3>
            <div id="result"></div>

            <h3>ğŸ“ è‡ªåŠ¨åˆ†ææè¿°</h3>
            <div id="desc" class="desc-box"></div>
        </div>
    </div>
</div>

<script>
function calculate() {

    /* ===== æˆç»©è§£æï¼ˆä¸ä½ æ­£ç¡®ç‰ˆæœ¬å®Œå…¨ä¸€è‡´ï¼‰ ===== */
    let scores = document.getElementById("scores").value
        .replace(/ï¼Œ/g,",")
        .split(/[\s,]+/)
        .map(s=>parseFloat(s))
        .filter(s=>!isNaN(s));

    if(scores.length<4){
        alert("æˆç»©æ•°é‡è¿‡å°‘ï¼Œæ— æ³•è®¡ç®—ï¼");
        return;
    }

    let W = parseFloat(document.getElementById("totalScore").value) || 100;
    let n = scores.length;
    const avg = arr => arr.reduce((a,b)=>a+b,0)/arr.length;

    /* ===== éš¾åº¦ & åŒºåˆ†åº¦ï¼ˆ27% åˆ†ç»„æ³•ï¼‰===== */
    let sorted = [...scores].sort((a,b)=>b-a);
    let m = Math.round(n*0.27);

    let high = sorted.slice(0,m);
    let low  = sorted.slice(n-m);

    let VH = avg(high);
    let VL = avg(low);

    let P = (VH + VL) / (2 * W);
    let D = (VH - VL) / W;

    /* ===== ä¿¡åº¦ï¼ˆå®Œå…¨é‡‡ç”¨ä½ ç»™çš„æ­£ç¡®ç‰ˆæœ¬ï¼‰===== */
    let mid = Math.floor(n/2);
    let group1 = scores.slice(0,mid);
    let group2 = scores.slice(mid);

    function variance(arr){
        let mean = avg(arr);
        let sum = arr.reduce((t,x)=>t+(x-mean)**2,0);
        return sum / arr.length;
    }

    let S1 = variance(group1);
    let S2 = variance(group2);
    let R  = S1 / S2;

    /* ===== æˆç»©åŒºé—´æ¯”ä¾‹ ===== */
    let ranges=[
        {name:"ä¼˜ç§€",count:scores.filter(s=>s>=90).length},
        {name:"è‰¯å¥½",count:scores.filter(s=>s>=80&&s<90).length},
        {name:"ä¸­ç­‰",count:scores.filter(s=>s>=70&&s<80).length},
        {name:"åŠæ ¼",count:scores.filter(s=>s>=60&&s<70).length},
        {name:"ä¸åŠæ ¼",count:scores.filter(s=>s<60).length}
    ];
    ranges.forEach(r=>r.rate=r.count/n*100);

    let mainRanges=[...ranges]
        .sort((a,b)=>b.rate-a.rate)
        .slice(0,2)
        .map(r=>r.name)
        .join("å’Œ");

    /* ===== æè¿°è¯ ===== */
    let Pd=P>=0.8?"å¤ªæ˜“":P>=0.6?"è¾ƒæ˜“":P>=0.4?"é€‚ä¸­":P>=0.2?"è¾ƒéš¾":"å¤ªéš¾";
    let Dd=D>=0.4?"åŒºåˆ†åº¦å¾ˆå¥½":D>0.3?"åŒºåˆ†åº¦è¾ƒå¥½":D>=0.2?"åŒºåˆ†åº¦ä¸€èˆ¬":"åŒºåˆ†åº¦å·®";
    let Rd=R<0.6?"è¯•é¢˜å­˜åœ¨ä¸¥é‡é—®é¢˜ï¼Œä¸å®œé‡‡ç”¨":R<0.8?"è¯•é¢˜è´¨é‡æœ‰æå‡ç©ºé—´":"è¯•å·å¯ä¿¡åº¦é«˜";

    /* ===== è¾“å‡º ===== */
    document.getElementById("result").innerHTML=`
        éš¾åº¦ Pï¼š<span class="highlight">${P.toFixed(2)}</span><br>
        åŒºåˆ†åº¦ Dï¼š<span class="highlight">${D.toFixed(2)}</span><br>
        ä¿¡åº¦ Rï¼š<span class="highlight">${R.toFixed(2)}</span><hr>
        ${ranges.map(r=>`${r.name}ç‡ï¼š${r.rate.toFixed(2)}%`).join("<br>")}
    `;

    document.getElementById("desc").innerHTML=`
        è¯•å·éš¾åº¦ä¸º ${P.toFixed(2)}ï¼Œè¡¨æ˜è¯•å·éš¾åº¦ä¸º${Pd}ï¼›
        è¯•å·åŒºåˆ†åº¦ä¸º ${D.toFixed(2)}ï¼Œ${Dd}ï¼›
        è¯•å·ä¿¡åº¦ä¸º ${R.toFixed(2)}ï¼Œ${Rd}ã€‚
        ä»æˆç»©åˆ†å¸ƒæƒ…å†µçœ‹ï¼Œå…¶ä¸­ä¼˜ç§€å  ${ranges[0].rate.toFixed(2)}%ï¼Œ
        è‰¯å¥½å  ${ranges[1].rate.toFixed(2)}%ï¼Œ
        ä¸­ç­‰å  ${ranges[2].rate.toFixed(2)}%ï¼Œ
        åŠæ ¼å  ${ranges[3].rate.toFixed(2)}%ï¼Œ
        ä¸åŠæ ¼å  ${ranges[4].rate.toFixed(2)}%ï¼Œ
        æˆç»©ä¸»è¦é›†ä¸­åœ¨${mainRanges}åŒºé—´ï¼Œ
        è¯•å·èƒ½å¤Ÿè¾ƒå¥½åœ°æ£€éªŒå­¦ç”Ÿå¯¹æ‰€å­¦çŸ¥è¯†çš„æŒæ¡æƒ…å†µã€‚
    `;
}
</script>
</body>
</html>
