<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>三度计算公式</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" rel="stylesheet">
    <style>
        .gradient-button {
            background-image: linear-gradient(135deg, #4f46e5 0%, #a855f7 100%);
            color: white;
        }
        .gradient-button:hover {
            background-image: linear-gradient(135deg, #3b32d6 0%, #8b45eb 100%);
        }
        .result-card {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
        /* 新增输入区域样式 */
        #inputArea {
            background-color: #e0f2f1; /* 浅蓝色背景 */
            width: 50%!important; /* 强制宽度50% */
            min-height: 600px; /* 固定高度 */
        }
        #sidebar {
            width: 50%!important; /* 强制宽度50% */
            min-height: 600px; /* 固定高度 */
        }
    </style>
</head>
<body class="bg-gray-100 font-sans leading-normal tracking-normal">
    <div class="container max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex flex-col md:flex-row items-start justify-between py-8">
            <div id="inputArea" class="md:w-2/3 bg-white p-6 rounded-lg shadow-md w-full">
                <h1 class="text-3xl font-bold text-gray-900 mb-4">三度计算公式</h1>
                <div class="mb-6">
                    <p class="text-lg font-medium text-gray-700 mb-2">
                        复制excel中全部学生成绩，粘贴在此区域（每行一个分数，支持换行分隔）：
                    </p>
                    <textarea 
                        id="scoreInput" 
                        class="w-full h-48 p-4 border border-gray-300 rounded-lg focus:border-indigo-500 focus:ring-indigo-500 text-sm" 
                        placeholder="复制Excel成绩数据后直接粘贴至此"
                    ></textarea>
                </div>
            </div>

            <div id="sidebar" class="md:w-1/3 md:mt-0 mt-8">
                <div class="sticky top-8 bg-white p-6 rounded-lg shadow-md h-full">
                    <button 
                        id="calculateBtn" 
                        class="w-full px-6 py-3 font-medium text-white rounded-lg gradient-button hover:shadow-lg transition-shadow"
                    >
                        生成分析结果 <i class="fas fa-chart-line ml-2"></i>
                    </button>

                    <div class="mt-8 h-full">
                        <h3 class="text-lg font-medium text-gray-700 mb-4">分析结果</h3>
                        <div id="difficulty" class="result-card p-5 mb-4">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="text-xl font-semibold text-gray-800">难度系数</p>
                                    <p class="text-gray-600 mt-2" id="difficultyValue">-</p>
                                </div>
                                <div class="text-2xl text-indigo-500">◈</div>
                            </div>
                            <p class="text-sm text-gray-500 mt-3" id="difficultyDesc">请输入数据后点击计算</p>
                        </div>

                        <div id="discrimination" class="result-card p-5 mb-4">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="text-xl font-semibold text-gray-800">区分度系数</p>
                                    <p class="text-gray-600 mt-2" id="discriminationValue">-</p>
                                </div>
                                <div class="text-2xl text-green-500">◈</div>
                            </div>
                            <p class="text-sm text-gray-500 mt-3" id="discriminationDesc">请输入数据后点击计算</p>
                        </div>

                        <div id="reliability" class="result-card p-5">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="text-xl font-semibold text-gray-800">信度系数</p>
                                    <p class="text-gray-600 mt-2" id="reliabilityValue">-</p>
                                </div>
                                <div class="text-2xl text-yellow-500">◈</div>
                            </div>
                            <p class="text-sm text-gray-500 mt-3" id="reliabilityDesc">请输入数据后点击计算</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('calculateBtn').addEventListener('click', function() {
            const scores = [];
            const textInput = document.getElementById('scoreInput').value.trim();
            
            textInput.split('\n').forEach(line => {
                const score = parseFloat(line.trim());
                if (!isNaN(score)) scores.push(score);
            });

            if (scores.length === 0) {
                alert('请输入有效的成绩数据（每行一个分数，换行分隔）');
                return;
            }

            processScores(scores);
        });

        function processScores(scores) {
            scores.sort((a, b) => b - a);
            const n = scores.length;
            const m = Math.ceil(n * 0.27);
            const VH = calculateAverage(scores.slice(0, m));
            const VL = calculateAverage(scores.slice(n - m, n));
            const W = 100;

            const P = (VH + VL) / (2 * W);
            const D = (VH - VL) / W;
            const half = Math.floor(n / 2);
            const group1 = scores.slice(0, half);
            const group2 = scores.slice(half, n);
            const var1 = calculateVariance(group1);
            const var2 = calculateVariance(group2);
            const Y = var1 / var2;

            document.getElementById('difficultyValue').textContent = P.toFixed(3);
            document.getElementById('difficultyDesc').textContent = getDifficultyText(P);
            
            document.getElementById('discriminationValue').textContent = D.toFixed(3);
            document.getElementById('discriminationDesc').textContent = getDiscriminationText(D);
            
            document.getElementById('reliabilityValue').textContent = `${(Y * 100).toFixed(1)}%`;
            document.getElementById('reliabilityDesc').textContent = getReliabilityText(Y);
        }

        function calculateAverage(arr) {
            return arr.reduce((sum, val) => sum + val, 0) / arr.length;
        }

        function calculateVariance(arr) {
            const avg = calculateAverage(arr);
            return arr.reduce((sum, val) => sum + Math.pow(val - avg, 2), 0) / arr.length;
        }

        function getDifficultyText(P) {
            if (P >= 0.8) return '试卷难度为太易';
            else if (P >= 0.6) return '试卷难度为较易';
            else if (P >= 0.4) return '试卷难度为适中';
            else if (P >= 0.2) return '试卷难度为较难';
            else return '试卷难度为太难';
        }

        function getDiscriminationText(D) {
            if (D >= 0.4) return '题目区分度很好（建议保留）';
            else if (D >= 0.3) return '题目区分度较好（建议优化）';
            else if (D >= 0.2) return '区分度一般，试卷需修改';
            else return '区分度差，题目应淘汰';
        }

        function getReliabilityText(Y) {
            if (Y < 0.6) return '信度低，试题存在严重问题（需重新设计）';
            else if (Y < 0.8) return '信度中等，试题质量有待提升（建议调整）';
            else return '信度高，试卷可信度强（可以使用）';
        }
    </script>
</body>
</html>
    